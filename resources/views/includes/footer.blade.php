
<!-- footer part -->
<div class="footer_part">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="footer_iner text-center">
                    <p>2025 © Influence - Designed by <a href="#"> <i class="ti-heart"></i> </a><a href="#"> ECHODATA</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
</section>
<!-- main content part end -->

<!-- ### CHAT_MESSAGE_BOX   ### -->

<div class="CHAT_MESSAGE_POPUPBOX">
    <div class="CHAT_POPUP_HEADER">
    <div class="MSEESAGE_CHATBOX_CLOSE">
    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M7.09939 5.98831L11.772 10.661C12.076 10.965 12.076 11.4564 11.772 11.7603C11.468 12.0643 10.9766 12.0643 10.6726 11.7603L5.99994 7.08762L1.32737 11.7603C1.02329 12.0643 0.532002 12.0643 0.228062 11.7603C-0.0760207 11.4564 -0.0760207 10.965 0.228062 10.661L4.90063 5.98831L0.228062 1.3156C-0.0760207 1.01166 -0.0760207 0.520226 0.228062 0.216286C0.379534 0.0646715 0.578697 -0.0114918 0.777717 -0.0114918C0.976738 -0.0114918 1.17576 0.0646715 1.32737 0.216286L5.99994 4.889L10.6726 0.216286C10.8243 0.0646715 11.0233 -0.0114918 11.2223 -0.0114918C11.4213 -0.0114918 11.6203 0.0646715 11.772 0.216286C12.076 0.520226 12.076 1.01166 11.772 1.3156L7.09939 5.98831Z" fill="white"/>
    </svg>

    </div>

    </div>
    <div class="CHAT_POPUP_BODY">
        <p class="mesaged_send_date">
        Sunday, 12 January
        </p>



    </div>
    <div class="CHAT_POPUP_BOTTOM">
        <div class="chat_input_box d-flex align-items-center">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Write your message" aria-label="Recipient's username" aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <button class="btn " type="button">
                        <!-- svg      -->
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.7821 3.21895C14.4908 -1.07281 7.50882 -1.07281 3.2183 3.21792C-1.07304 7.50864 -1.07263 14.4908 3.21872 18.7824C7.50882 23.0729 14.4908 23.0729 18.7817 18.7815C23.0726 14.4908 23.0724 7.50906 18.7821 3.21895ZM17.5813 17.5815C13.9525 21.2103 8.04773 21.2108 4.41871 17.5819C0.78907 13.9525 0.789485 8.04714 4.41871 4.41832C8.04752 0.789719 13.9521 0.789304 17.5817 4.41874C21.2105 8.04755 21.2101 13.9529 17.5813 17.5815ZM6.89503 8.02162C6.89503 7.31138 7.47107 6.73534 8.18131 6.73534C8.89135 6.73534 9.46739 7.31117 9.46739 8.02162C9.46739 8.73228 8.89135 9.30811 8.18131 9.30811C7.47107 9.30811 6.89503 8.73228 6.89503 8.02162ZM12.7274 8.02162C12.7274 7.31138 13.3038 6.73534 14.0141 6.73534C14.7241 6.73534 15.3002 7.31117 15.3002 8.02162C15.3002 8.73228 14.7243 9.30811 14.0141 9.30811C13.3038 9.30811 12.7274 8.73228 12.7274 8.02162ZM15.7683 13.2898C14.9712 15.1332 13.1043 16.3243 11.0126 16.3243C8.8758 16.3243 6.99792 15.1272 6.22834 13.2744C6.09642 12.9573 6.24681 12.593 6.56438 12.4611C6.64238 12.4289 6.72328 12.4136 6.80293 12.4136C7.04687 12.4136 7.27836 12.5577 7.37772 12.7973C7.95376 14.1842 9.38048 15.0799 11.0126 15.0799C12.6077 15.0799 14.0261 14.1836 14.626 12.7959C14.7625 12.4804 15.1288 12.335 15.4441 12.4717C15.7594 12.6084 15.9048 12.9745 15.7683 13.2898Z" fill="#707DB7"/>
                        </svg>

                        <!-- svg      -->
                    </button>
                    <button class="btn" type="button">
                         <!-- svg  -->
                         <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 0.289062C4.92455 0.289062 0 5.08402 0 10.9996C0 16.9152 4.92455 21.7101 11 21.7101C17.0755 21.7101 22 16.9145 22 10.9996C22 5.08472 17.0755 0.289062 11 0.289062ZM11 20.3713C5.68423 20.3713 1.375 16.1755 1.375 10.9996C1.375 5.82371 5.68423 1.62788 11 1.62788C16.3158 1.62788 20.625 5.82371 20.625 10.9996C20.625 16.1755 16.3158 20.3713 11 20.3713ZM15.125 10.3302H11.6875V6.98314C11.6875 6.61363 11.3795 6.31373 11 6.31373C10.6205 6.31373 10.3125 6.61363 10.3125 6.98314V10.3302H6.875C6.4955 10.3302 6.1875 10.6301 6.1875 10.9996C6.1875 11.3691 6.4955 11.669 6.875 11.669H10.3125V15.016C10.3125 15.3855 10.6205 15.6854 11 15.6854C11.3795 15.6854 11.6875 15.3855 11.6875 15.016V11.669H15.125C15.5045 11.669 15.8125 11.3691 15.8125 10.9996C15.8125 10.6301 15.5045 10.3302 15.125 10.3302Z" fill="#707DB7"/>
                        </svg>

                         <!-- svg  -->
                         <input type="file">
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--/### CHAT_MESSAGE_BOX  ### -->

<div id="back-top" style="display: none;">
    <a title="Go to Top" href="#">
        <i class="ti-angle-up"></i>
    </a>
</div>

<div class="modal fade" id="shiftInCashInHandModal" tabindex="-1" aria-labelledby="ShiftInCashInHandLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="ShiftInCashInHandLabel">{{ auth()->user()->name }}, Start Your Shift – Enter Opening Cash</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <form id="shiftInCashInHandForm">
                <div class="modal-body">
                    <div class="mb-3">
{{--                        <label for="shiftInCashBalance" class="form-label">Enter Cash in Hand</label>--}}
                        <input type="number" id="shiftInCashBalance" name="shiftInCashBalance" class="form-control form-control-lg" placeholder="0.00" required>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="submit" id="saveShiftInCashBalanceBtn" class="btn btn-primary w-100" onclick="startShift()">
                        Start Shift
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<div class="modal fade" id="dayEndCashInHandModal" tabindex="-1" aria-labelledby="dayEndCashInHandLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="dayEndCashInHandLabel">{{ auth()->user()->name }}, End of Shift – Confirm Cash in Hand</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">

                <!-- Section 1: Get Shift End Report -->
                <div class="mb-4 border rounded p-3">
                    <h6 class="mb-3">Get Previous Shift Details</h6>

                    <div class="row g-2 align-items-center">
                        <div class="col-md-7">
                            <label for="reportShiftId" class="form-label">Select Shift ID</label>
                            <select class="nice_Select wide mb_30" id="reportShiftId"></select>
                        </div>

                        <div class="col-md-5 d-flex align-items-center">
                            <button type="button" id="btnGetShiftReport" class="btn btn-secondary w-100 h-100" style="margin-top: 10px;" onclick="getShitDetails()">
                                Shift End Report
                            </button>
                        </div>
                    </div>
                </div>


                <!-- Section 2: End Shift (Cash in Hand) -->
                <form id="dayEndCashInHandForm" onsubmit="ShiftEnd(event)">
                    <div class="mb-3">
                        <label for="dayEndCashBalance" class="form-label">Confirm Cash in Hand</label>
                        <input type="number" id="dayEndCashBalance" name="dayEndCashBalance" class="form-control form-control-lg" placeholder="0.00" required />
                    </div>

                    <div class="d-grid">
                        <button type="submit" id="saveShiftEndCashBalanceBtn" class="btn btn-primary">
                            End Shift
                        </button>
                    </div>
                </form>

            </div>

        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="shiftSummaryModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body" id="shiftSummaryContent"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="printShiftReport()">Print</button>
            </div>
        </div>
    </div>
</div>




<script src="{{ asset('assets/js/popper1.min.js') }}"></script>
<script src="{{ asset('assets/js/bootstrap1.min.js') }}"></script>
<script src="{{ asset('assets/js/metisMenu.js') }}"></script>
<script src="{{ asset('assets/vendors/count_up/jquery.waypoints.min.js') }}"></script>
<script src="{{ asset('assets/vendors/chartlist/Chart.min.js') }}"></script>
<script src="{{ asset('assets/vendors/count_up/jquery.counterup.min.js') }}"></script>

<script src="{{ asset('assets/vendors/niceselect/js/jquery.nice-select.min.js') }}"></script>
<script src="{{ asset('assets/vendors/owl_carousel/js/owl.carousel.min.js') }}"></script>

<script src="{{ asset('assets/vendors/datatable/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/dataTables.responsive.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/dataTables.buttons.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/buttons.flash.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/jszip.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/pdfmake.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/vfs_fonts.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/buttons.html5.min.js') }}"></script>
<script src="{{ asset('assets/vendors/datatable/js/buttons.print.min.js') }}"></script>

<script src="{{ asset('assets/vendors/datepicker/datepicker.js') }}"></script>
<script src="{{ asset('assets/vendors/datepicker/datepicker.en.js') }}"></script>
<script src="{{ asset('assets/vendors/datepicker/datepicker.custom.js') }}"></script>

<script src="{{ asset('assets/js/chart.min.js') }}"></script>
<script src="{{ asset('assets/vendors/chartjs/roundedBar.min.js') }}"></script>

<script src="{{ asset('assets/vendors/progressbar/jquery.barfiller.js') }}"></script>
<script src="{{ asset('assets/vendors/tagsinput/tagsinput.js') }}"></script>
<script src="{{ asset('assets/vendors/text_editor/summernote-bs4.js') }}"></script>
<script src="{{ asset('assets/vendors/am_chart/amcharts.js') }}"></script>

<script src="{{ asset('assets/vendors/scroll/perfect-scrollbar.min.js') }}"></script>
<script src="{{ asset('assets/vendors/scroll/scrollable-custom.js') }}"></script>

<script src="{{ asset('assets/vendors/apex_chart/apex-chart2.js') }}"></script>
<script src="{{ asset('assets/vendors/apex_chart/apex_dashboard.js') }}"></script>

<script src="{{ asset('assets/vendors/chart_am/core.js') }}"></script>
<script src="{{ asset('assets/vendors/chart_am/charts.js') }}"></script>
<script src="{{ asset('assets/vendors/chart_am/animated.js') }}"></script>
<script src="{{ asset('assets/vendors/chart_am/kelly.js') }}"></script>
<script src="{{ asset('assets/vendors/chart_am/chart-custom.js') }}"></script>

<script src="{{ asset('assets/js/dashboard_init.js') }}"></script>
<script src="{{ asset('assets/js/custom.js') }}"></script>

<script src="{{ asset('assets/vendors/npm/sweetalert2@11') }}"></script>



<script>

    const token = $('meta[name="api-token"]').attr('content');
    const role = $('meta[name="user-role"]').attr('content');
    const userID = $('meta[name="user-id"]').attr('content');

function updateDateTime() {
    const now = new Date();

    const date = now.toLocaleDateString('en-GB');
    const time = now.toLocaleTimeString('en-GB', { hour12: false });

    document.getElementById('datetime').innerHTML = date + '&nbsp;&nbsp;&nbsp;' + time;
}

setInterval(updateDateTime, 1000);
updateDateTime();

$(document).ready(function () {
    if (role === 'cashier') {
        $.ajax({
            url: '/api/userShift',
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            },
            success: function (response) {
                if (response.user_id == null) {
                    $('#shiftInBtn').show();
                    $('#shiftOutBtn').hide();
                    if (!sessionStorage.getItem('cashier_popup_shown')) {
                        $('#shiftInCashInHandModal').modal('show');
                        sessionStorage.setItem('cashier_popup_shown', 'true');
                    }
                } else if(response.user_id == userID){
                    $('#shiftOutBtn').show();
                    $('#shiftInBtn').hide();

                } else {
                    $('#shiftOutBtn').hide();
                    $('#shiftInBtn')
                        .show()
                        .prop('disabled', true);
                }
            },
            error: function (xhr) {
                const response = xhr.responseJSON;
                Swal.fire({
                    icon: "error",
                    title: response?.message || "Something went wrong",
                    showConfirmButton: false,
                    timer: 1500
                });
            }
        });
    }
});

$('#shiftInCashInHandForm').on('submit', function (e) {
    e.preventDefault();
});

function startShift(){
    const token = $('meta[name="api-token"]').attr('content');
    const userID = $('meta[name="user-id"]').attr('content');
    const data = {
        opening_cash_in_hand: $('#shiftInCashBalance').val(),
        user_id: userID
    };

    $.ajax({
        url: '/api/userShift',
        method: 'POST',
        headers: {
            'Authorization': 'Bearer ' + token
        },
        data: data,
        success: function (response) {
            sessionStorage.setItem('cashier_popup_shown', 'true');
            $('#shiftInCashInHandModal').modal('hide');

            if(response.data == null){
                Swal.fire({
                    icon: "error",
                    title: response.message,
                    showConfirmButton: false,
                    timer: 1500
                });
            }else{
                Swal.fire({
                    icon: "success",
                    title: "Login Successfully",
                    showConfirmButton: false,
                    timer: 1500
                });

                $('#shiftOutBtn').show();
                $('#shiftInBtn').hide();
            }


        },
        error: function (xhr) {
            const response = xhr.responseJSON;
            Swal.fire({
                icon: "error",
                title: response?.message || "Something went wrong",
                showConfirmButton: false,
                timer: 1500
            });
        }
    });
}

function ShiftEnd(event) {
        event.preventDefault();
    const data = {
        day_end_cash_in_hand: $('#dayEndCashBalance').val(),
        user_id: userID
    };

    $.ajax({
        url: '/api/userShift/${userID}',
        method: 'PUT',
        headers: {
            'Authorization': 'Bearer ' + token
        },
        data: data,
        success: function (response) {
            printShiftFullSummary(response.data);

            setTimeout(() => {
                Swal.fire({
                    icon: "success",
                    title: "Logging out...",
                    showConfirmButton: false,
                    timer: 1000
                });

                setTimeout(() => {
                    sessionStorage.removeItem('cashier_popup_shown');
                    document.getElementById('logout-form').submit();
                }, 1000);

            }, 500);
        },
        error: function (xhr) {
            const response = xhr.responseJSON;
            Swal.fire({
                icon: "error",
                title: response?.message || "Something went wrong",
                showConfirmButton: false,
                timer: 1500
            });
        }
    });
}

    function printShiftFullSummary(data) {
        const formatAmount = (val) => parseFloat(val || 0).toFixed(2);
        const formatDateTime = (datetime) => {
            const date = new Date(datetime);
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        };
        const formatDate = (datetime) => {
            const date = new Date(datetime);
            return date.toLocaleDateString('en-GB');
        };

        const openingCash = parseFloat(data.opening_cash_in_hand || 0);
        const salesTotal = parseFloat(data.total_daily_sales || 0);
        const expenseTotal = parseFloat(data.total_daily_expenses || 0);
        const cashInHand = parseFloat(data.day_end_cash_in_hand || 0);
        const cashShortage = parseFloat(data.cash_shortage || 0);
        const shiftOffTime = data.shift_off_time;
        const shiftInTime = data.shift_in_time;
        const shiftID = data.shift_id;
        const userName = data.user_name;
        const cashHandover = cashInHand - cashShortage;

        const hasVariation = cashShortage !== 0;
        const variationText = cashShortage > 0 ? "Total Cash Excess" : "Total Cash Lost";
        const variationSign = cashShortage > 0 ? "+" : "(-)";

        const salesHtml = data.sales_entries.map(entry => `
        <tr>
            <td>+ ${entry.reference_id || 'N/A'}</td>
            <td class="text-right">${formatAmount(entry.debit)}</td>
        </tr>
    `).join('');

        const expenseHtml = data.expense_entries.map(entry => `
        <tr>
            <td>- ${entry.reference_id || 'N/A'}</td>
            <td class="text-right">${formatAmount(entry.debit)}</td>
        </tr>
    `).join('');

        const html = `
<html>
<head>
    <title>Shift Summary</title>
    <style>
        body { font-family: 'Times New Roman', serif; font-size: 14px; padding: 20px; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        hr { border: none; border-top: 2px solid #000; margin: 10px 0; }
        table { width: 100%; margin-bottom: 10px; border-collapse: collapse; }
        td { padding: 4px 0; vertical-align: top; }
    </style>
</head>
<body>

    <div class="text-center">
        <h5 class="bold">TRIMLY</h5>
        <h6 class="bold">DAILY INCOME & EXPENDITURE REPORT</h6>
        <div>${formatDate(shiftOffTime)}</div>
    </div>

    <hr>

    <table>
        <tr><td colspan="2" class="bold">1.0 Cashier Activity Details</td></tr>
        <tr><td>* Shift ID</td><td>: ${shiftID}</td></tr>
        <tr><td>* User</td><td>: ${userName}</td></tr>
        <tr><td>* On Time</td><td>: ${formatDateTime(shiftInTime)}</td></tr>
        <tr><td>* Opening Cash</td><td>: ${formatAmount(openingCash)}</td></tr>
    </table>

    <hr>

    <table>
        <tr><td colspan="2" class="bold">2.0 Sales Collection</td></tr>
        ${salesHtml}
        <tr><td class="bold">Total Sales</td><td class="text-right bold">${formatAmount(salesTotal)}</td></tr>
    </table>

    <hr>

    <table>
        <tr><td colspan="2" class="bold">3.0 Expenses</td></tr>
        ${expenseHtml}
        <tr><td class="bold">Total Expenses</td><td class="text-right bold">${formatAmount(expenseTotal)}</td></tr>
    </table>

    <hr>

    <table>
        <tr><td colspan="2" class="bold">4.0 Sign-Off Summary</td></tr>
        <tr><td>Off Time</td><td class="text-right">${formatDateTime(shiftOffTime)}</td></tr>
        <tr><td>Printed Time</td><td class="text-right">${formatDateTime(new Date())}</td></tr>
        <tr><td><b>Cash in Hand</b></td><td class="text-right bold">${formatAmount(cashInHand)}</td></tr>
        <tr><td><b>Cash Handover</b></td><td class="text-right bold">${formatAmount(cashHandover)}</td></tr>
        ${hasVariation ? `
        <tr><td><b>${variationText}</b></td>
        <td class="text-right bold">${variationSign} ${formatAmount(Math.abs(cashShortage))}</td></tr>` : ''}
    </table>

    <hr>
    <div class="text-center">--- END OF REPORT ---</div>

</body>
</html>
`;

        const printWindow = window.open('', '_blank');
        printWindow.document.open();
        printWindow.document.write(html);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }


function formatDateTime(dt) {
    const date = new Date(dt);
    return date.toLocaleString();
}


function dayEnd(){
    const token = $('meta[name="api-token"]').attr('content');
    const userID = $('meta[name="user-id"]').attr('content');
    const data = {
        opening_cash_in_hand: $('#shiftInCashBalance').val(),
        user_id: userID
    };

    $.ajax({
        url: '/api/userShift',
        method: 'POST',
        headers: {
            'Authorization': 'Bearer ' + token
        },
        data: data,
        success: function () {
            sessionStorage.setItem('cashier_popup_shown', 'true');
            $('#shiftOutCashInHandModal').modal('hide');

            Swal.fire({
                icon: "success",
                title: "Login Successfully",
                showConfirmButton: false,
                timer: 1500
            });

            $('#shiftOutBtn').show();
            $('#shiftInBtn').hide();
        },
        error: function (xhr) {
            const response = xhr.responseJSON;
            Swal.fire({
                icon: "error",
                title: response?.message || "Something went wrong",
                showConfirmButton: false,
                timer: 1500
            });
        }
    });
}

function showShiftEndModal(){
    $('#dayEndBalance').val('');
    loadShiftID();
}

function loadShiftID() {
    $.ajax({
        url: '/api/shift-id-dropdown',
        method: 'GET',
        success: function (response) {
            var select = $('#reportShiftId');

            select.empty();

            select.append('<option value="">Select Shift ID</option>');
            response.forEach(function (item) {
                select.append('<option value="' + item.value + '">' + item.label + '</option>');
            });

            if ($.fn.niceSelect) {
                select.niceSelect('update');
            }

        },
        error: function (xhr, status, error) {
            console.error('Error loading token numbers:', error);
        }
    });
}

function getShitDetails(){
    let shiftID = $('#reportShiftId').val();
    $.ajax({
        url: `/api/load-shift-details/${shiftID}`,
        method: 'GET',
        success: function (data) {
            showShiftSummaryModal(data);

        },
        error: function (xhr, status, error) {
            console.error('Error loading token numbers:', error);
        }
    });
}

    function showShiftSummaryModal(data) {

        const formatAmount = (val) => parseFloat(val || 0).toFixed(2);
        const formatDateTime = (datetime) => {
            const date = new Date(datetime);
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        };
        const formatDate = (datetime) => {
            const date = new Date(datetime);
            return date.toLocaleDateString('en-GB');
        };

        const openingCash = parseFloat(data.opening_cash_in_hand || 0);
        const salesTotal = parseFloat(data.total_daily_sales || 0);
        const expenseTotal = parseFloat(data.total_daily_expenses || 0);
        const cashInHand = parseFloat(data.day_end_cash_in_hand || 0);
        const cashShortage = parseFloat(data.cash_shortage || 0);
        const shiftOffTime = data.shift_off_time;
        const shiftInTime = data.shift_in_time;
        const shiftID = data.shift_id;
        const userName = data.user_name;
        const cashHandover = cashInHand - cashShortage;

        const hasVariation = cashShortage !== 0;
        const variationText = cashShortage > 0 ? "Total Cash Excess" : "Total Cash Lost";
        const variationSign = cashShortage > 0 ? "+" : "(-)";

        const salesHtml = data.sales_entries.map(entry => `
        <tr>
            <td>+ ${entry.reference_id || 'N/A'}</td>
            <td class="text-right">${formatAmount(entry.debit)}</td>
        </tr>
    `).join('');

        const expenseHtml = data.expense_entries.map(entry => `
        <tr>
            <td>- ${entry.reference_id || 'N/A'}</td>
            <td class="text-right">${formatAmount(entry.debit)}</td>
        </tr>
    `).join('');

        const html = `
    <div id="shiftReportContent">
        <style>
            body {  font-size: 14px; }
            .text-center { text-align: center; }
            .text-right { text-align: right; }
            .bold { font-weight: bold; }
            hr { border: none; border-top: 2px solid #000; margin: 10px 0; }
            table { width: 100%; margin-bottom: 10px; border-collapse: collapse; }
            td { padding: 4px 0; vertical-align: top; }
        </style>

        <div class="text-center">
            <h5 class="bold">TRIMLY</h5>
            <h6 class="bold">DAILY INCOME & EXPENDITURE REPORT</h6>
            <div>${formatDate(shiftOffTime)}</div>
        </div>

        <hr>

        <table>
            <tr><td colspan="2" class="bold">1.0 Cashier Activity Details</td></tr>
            <tr><td>* Shift ID</td><td>: ${shiftID}</td></tr>
            <tr><td>* User</td><td>: ${userName}</td></tr>
            <tr><td>* On Time</td><td>: ${formatDateTime(shiftInTime)}</td></tr>
            <tr><td>* Opening Cash</td><td>: ${formatAmount(openingCash)}</td></tr>
        </table>

        <hr>

        <table>
            <tr><td colspan="2" class="bold">2.0 Sales Collection</td></tr>
            ${salesHtml}
            <tr><td class="bold">Total Sales</td><td class="text-right bold">${formatAmount(salesTotal)}</td></tr>
        </table>

        <hr>

        <table>
            <tr><td colspan="2" class="bold">3.0 Expenses</td></tr>
            ${expenseHtml}
            <tr><td class="bold">Total Expenses</td><td class="text-right bold">${formatAmount(expenseTotal)}</td></tr>
        </table>

        <hr>

        <table>
            <tr><td colspan="2" class="bold">4.0 Sign-Off Summary</td></tr>
            <tr><td>Off Time</td><td class="text-right">${formatDateTime(shiftOffTime)}</td></tr>
            <tr><td>Printed Time</td><td class="text-right">${formatDateTime(new Date())}</td></tr>
            <tr><td><b>Cash in Hand</b></td><td class="text-right bold">${formatAmount(cashInHand)}</td></tr>
            <tr><td><b>Cash Handover</b></td><td class="text-right bold">${formatAmount(cashHandover)}</td></tr>
            ${hasVariation ? `
            <tr><td><b>${variationText}</b></td>
            <td class="text-right bold">${variationSign} ${formatAmount(Math.abs(cashShortage))}</td></tr>` : ''}
        </table>

        <hr>
        <div class="text-center">--- END OF REPORT ---</div>
    </div>
    `;

        document.getElementById("shiftSummaryContent").innerHTML = html;
        let modal = new bootstrap.Modal(document.getElementById("shiftSummaryModal"));
        modal.show();
    }

    function printShiftReport() {
        const printContent = document.getElementById("shiftReportContent").innerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.open();
        printWindow.document.write(`<html><head><title>Shift Summary</title></head><body>${printContent}</body></html>`);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }




</script>
</body>
</html>
